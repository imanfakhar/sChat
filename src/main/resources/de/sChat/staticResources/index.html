<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>html5-Grundger√ºst</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
		function send(name,msg)
		{
		$.ajax({
    		type: "POST",
    		url: "/msg/sendMessage/",
    		data: JSON.stringify({"data":{"message":msg,"name":name},"type":"message"}),
    		contentType: "application/json; charset=utf-8",
    		dataType: "json",
    		failure: function(errMsg) {alert(errMsg);}
			});
		}
		var time = 0;
		var name = "";
		function resive()
		{
		var ttime = Math.floor(Date.now() / 1000);
		$.ajax({
    		type: "GET",
    		url: "/msg/getMessage/",
    		data: "time="+time+"&name="+name,
    		contentType: "application/json; charset=utf-8",
    		dataType: "json",
    		success: function(array){
    		 for (var i = 0; i < array.length; i++) {
    		    data = array[i];
    			if(data.type == "message")
    			{
    				$('#textarea').val($('#textarea').val()+'\n'+data.data.name+": "+data.data.message);
    			}
    		 }
    		},
    		failure: function(errMsg) {alert(errMsg);}
			});	
		time = ttime;	
		}
		function sendMsg()
		{
			text = $('#input_msg').val();
			send(name,text);
		}
		function onload()
		{
			$('#textarea').val("");
			name = prompt("Please enter your name", "Harry Potter");
			setInterval(function(){resive()}, 4000);
		}
	</script>
</head>
<body onload="onload()">
	<h2>sChat - Webclient</h2>
	<textarea name="textarea" id="textarea" rows="15" cols="300"></textarea>
	<hr>
	<input name="input_msg" id="input_msg" type="text">
	<input name="input_send" id="input_send" type="button" value="Senden!" onclick="sendMsg();">
</body>
</html>